"use client"
import React, { useState } from 'react'
import { useChat } from 'ai/react';
import { Message } from 'ai';
import '@/app/dashboard/style.css';
import Bubble from '../components/Bubble';
import LoadingBubble from '../components/LoadingBubble';
import PromptSuggestionRow from '../components/PromtSuggestionRow';
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';
import { faCheck, faFileUpload } from '@fortawesome/free-solid-svg-icons';
import { useRouter } from 'next/navigation';
import { signOut } from 'next-auth/react';
const HomePage = () => {
  const { input, append, isLoading, messages, handleInputChange, handleSubmit } = useChat();
  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const handleButtonClick = () => {
    document.getElementById('file-upload')?.click();
  };

  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (file && file.type === 'application/pdf') {
      setSelectedFile(file);
    } else {
      alert('Please upload a valid PDF file.');
    }
  };
  const handlePrompt = (promptText) => {
    const msg: Message = {
      id: crypto.randomUUID(),
      content: promptText,
      role: "user"
    }
    append(msg)
  }
  const noMessages = !messages || messages.length === 0;
  const router= useRouter();
  const handleLogOut=async ()=>{
    const res= await signOut({
      redirect:false,
    })
    router.push('/')
  }
  return (
    <div>
      <div>
        <button className="Btn" onClick={handleLogOut}>

          <div className="sign"><svg viewBox="0 0 512 512"><path d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"></path></svg></div>

          <div className="text">Logout</div>
        </button>
      </div>
      <div className="cont">
        <main className='dashdiv'>
          <svg width="134" height="33" viewBox="0 0 134 33" fill="none" xmlns="http://www.w3.org/2000/svg" className='mt-2 mb-2 min-h-[50px] '>
            <path d="M2.76 32.04C1.77333 32.04 1.10667 31.7867 0.76 31.28C0.413333 30.7733 0.24 30.2133 0.24 29.6V2.64C0.24 2.02667 0.413333 1.48 0.76 0.999999C1.10667 0.493332 1.77333 0.239999 2.76 0.239999H16.68C17.6667 0.239999 18.1867 0.906666 18.24 2.24C18.2933 3.6 17.7733 4.28 16.68 4.28H4.96V28H17.4C18.3867 28 18.8933 28.6533 18.92 29.96C18.9733 31.3467 18.4667 32.04 17.4 32.04H2.76ZM15.2 15.48C15.2 16.4133 14.8667 17.2 14.2 17.84C13.56 18.48 12.7733 18.8 11.84 18.8C10.9333 18.8 10.16 18.48 9.52 17.84C8.88 17.2 8.56 16.4133 8.56 15.48C8.56 14.5467 8.88 13.76 9.52 13.12C10.16 12.48 10.9333 12.16 11.84 12.16C12.7733 12.16 13.56 12.48 14.2 13.12C14.8667 13.76 15.2 14.5467 15.2 15.48ZM37.7269 11.68H30.0069C28.9135 11.68 28.1935 12 27.8469 12.64C27.4735 13.2 27.2869 13.8533 27.2869 14.6V26.12C27.2869 26.8133 27.5002 27.3467 27.9269 27.72C28.3535 28.0667 29.0602 28.24 30.0469 28.24H34.1669C35.1269 28.24 35.6069 28.8667 35.6069 30.12C35.6069 30.6533 35.4869 31.1067 35.2469 31.48C35.0335 31.8267 34.6735 32 34.1669 32H29.3269C27.6469 32 26.1535 31.5733 24.8469 30.72C23.5402 29.92 22.8869 28.4 22.8869 26.16V14.24C22.8869 13.1467 23.0602 12.2 23.4069 11.4C23.7535 10.6 24.3002 9.94667 25.0469 9.44C26.4602 8.42666 27.8735 7.92 29.2869 7.92H37.7269V1.92C37.7269 0.639999 38.4602 -4.76837e-07 39.9269 -4.76837e-07C41.3935 -4.76837e-07 42.1269 0.639999 42.1269 1.92V30.32C42.1269 31.6 41.3935 32.24 39.9269 32.24C39.3669 32.24 38.8602 32.1467 38.4069 31.96C37.9535 31.7467 37.7269 31.2933 37.7269 30.6V11.68ZM66.6581 25.64C66.6581 26.7067 66.4715 27.6533 66.0981 28.48C65.7248 29.3067 65.1915 29.9733 64.4981 30.48H64.5381C63.8715 30.9333 63.1648 31.3067 62.4181 31.6C61.6715 31.8667 60.9515 32 60.2581 32H53.8181C53.1515 32 52.4315 31.8667 51.6581 31.6C50.9115 31.3067 50.2048 30.9333 49.5381 30.48H49.5781C48.8848 29.9733 48.3515 29.3067 47.9781 28.48C47.6048 27.6533 47.4181 26.7067 47.4181 25.64V9.6C47.4181 8.32 48.1515 7.68 49.6181 7.68C51.0848 7.68 51.8181 8.32 51.8181 9.6V25.32C51.8181 26.0667 52.0048 26.72 52.3781 27.28C52.7248 27.92 53.4448 28.24 54.5381 28.24H59.5381C60.6048 28.24 61.3115 27.92 61.6581 27.28L61.6181 27.32C62.0448 26.68 62.2581 26.0133 62.2581 25.32V9.6C62.2581 8.32 62.9915 7.68 64.4581 7.68C65.9248 7.68 66.6581 8.32 66.6581 9.6V25.64ZM88.6359 20.2C88.6359 19.5867 88.4093 19 87.9559 18.44C87.5026 17.8533 86.7026 17.52 85.5559 17.44C84.8093 18.3467 83.9026 18.8 82.8359 18.8C81.9293 18.8 81.1559 18.48 80.5159 17.84C79.8759 17.2 79.5559 16.4133 79.5559 15.48C79.5559 14.5467 79.8759 13.76 80.5159 13.12C81.1559 12.48 81.9293 12.16 82.8359 12.16C83.3159 12.16 83.7826 12.2933 84.2359 12.56C84.7159 12.8267 85.1426 13.1467 85.5159 13.52C86.1026 13.4933 86.5559 13.4 86.8759 13.24C87.1959 13.08 87.4226 12.8933 87.5559 12.68C87.7159 12.44 87.8093 12.1733 87.8359 11.88C87.8626 11.5867 87.8759 11.2933 87.8759 11V6.96C87.8759 6.29333 87.6626 5.68 87.2359 5.12C86.8359 4.56 86.1426 4.28 85.1559 4.28H76.7959L76.7559 30.68C76.7559 31.2133 76.5026 31.6267 75.9959 31.92C75.5159 32.1867 74.9826 32.32 74.3959 32.32C72.8226 32.32 72.0359 31.68 72.0359 30.4V2.64C72.0359 1.68 72.2759 1.04 72.7559 0.719997C73.2626 0.399998 73.8626 0.239999 74.5559 0.239999H86.1559C86.8493 0.239999 87.5826 0.373332 88.3559 0.639998C89.1559 0.906665 89.9026 1.26666 90.5959 1.72H90.5559C91.2493 2.22667 91.7559 2.89333 92.0759 3.72C92.4226 4.54666 92.5959 5.50666 92.5959 6.6V11.12C92.5959 12.1867 92.3693 13.0667 91.9159 13.76C91.4626 14.4267 90.9826 14.96 90.4759 15.36C90.8226 15.5733 91.1559 15.8 91.4759 16.04C91.7959 16.2533 92.0626 16.4933 92.2759 16.76C92.6226 17.1333 92.8893 17.5733 93.0759 18.08C93.2893 18.5867 93.3959 19.1867 93.3959 19.88V25.6C93.3959 27.7867 92.5426 29.4 90.8359 30.44C89.9826 30.9733 89.1693 31.3733 88.3959 31.64C87.6493 31.9067 86.9026 32.04 86.1559 32.04H80.2359C79.7826 32.04 79.4226 31.8533 79.1559 31.48C78.9159 31.1067 78.7959 30.6133 78.7959 30C78.7959 28.6667 79.3559 28 80.4759 28H85.9559C86.9426 28 87.6359 27.72 88.0359 27.16C88.4359 26.6 88.6359 25.9733 88.6359 25.28V20.2ZM111.82 7.92C112.513 7.92 113.22 8.06666 113.94 8.36C114.686 8.65333 115.406 9.02667 116.1 9.48H116.06C116.753 9.98667 117.286 10.6533 117.66 11.48C118.033 12.28 118.22 13.2133 118.22 14.28V25.64C118.22 27.8267 117.5 29.44 116.06 30.48C114.646 31.4933 113.233 32 111.82 32H105.42C104.726 32 104.02 31.88 103.3 31.64C102.58 31.4 101.873 31.0133 101.18 30.48C99.7397 29.4667 99.0197 27.8533 99.0197 25.64V14.28C99.0197 13.2133 99.2064 12.28 99.5797 11.48C99.953 10.6533 100.486 9.98667 101.18 9.48H101.14C101.806 9.02667 102.513 8.65333 103.26 8.36C104.006 8.06666 104.726 7.92 105.42 7.92H111.82ZM111.1 28.24C112.086 28.24 112.78 27.96 113.18 27.4C113.606 26.84 113.82 26.24 113.82 25.6V14.32C113.82 13.6533 113.606 13.0533 113.18 12.52C112.78 11.96 112.086 11.68 111.1 11.68H106.14C105.153 11.68 104.446 11.96 104.02 12.52C103.62 13.0533 103.42 13.6533 103.42 14.32V25.6C103.42 26.24 103.62 26.84 104.02 27.4C104.446 27.96 105.153 28.24 106.14 28.24H111.1ZM128.518 11.68V26.24C128.518 26.9333 128.664 27.4667 128.958 27.84C129.251 28.2133 129.878 28.4 130.838 28.4H131.878C132.918 28.4 133.411 29.0133 133.358 30.24C133.358 31.4933 132.864 32.12 131.878 32.12H130.558C129.704 32.12 128.904 32.0133 128.158 31.8C127.411 31.56 126.691 31.2267 125.998 30.8V30.84C124.691 29.9867 124.038 28.4667 124.038 26.28V11.68H122.478C121.518 11.68 121.011 11.0533 120.958 9.8C120.958 8.54667 121.464 7.92 122.478 7.92H124.038V3.64C124.038 2.36 124.798 1.72 126.317 1.72C127.784 1.72 128.518 2.36 128.518 3.64V7.92H131.838C132.878 7.92 133.371 8.54667 133.318 9.8C133.318 11.0533 132.824 11.68 131.838 11.68H128.518Z" fill="white" />
          </svg>

          <section className={noMessages ? "" : "populated"}>
            {noMessages ? (
              <>
                <p className='starter-text'>
                  Welcome to the Future of Education! ðŸš€
                  <br />
                  Iâ€™m Rag Chat Bot, your personal guide to unlocking knowledge. Just upload your PDF, and Iâ€™ll help you find answers, insights, and explanationsâ€”fast. No exams, no stressâ€”just pure learning, anytime, anywhere.
                </p>
                <br />
                <PromptSuggestionRow onPromptClick={handlePrompt} />
              </>
            ) : (
              <>
                {messages.map((message, index) => <Bubble key={`message-${index}`} message={message} />)}
                {isLoading && <LoadingBubble />}
              </>
            )}
          </section>
          <form onSubmit={handleSubmit} className=''>
            <input className='question-box' onChange={handleInputChange} value={input} placeholder='Ask me something...' />
            <input type='submit' />
            <div className="file-upload-container">
            </div>
            <div className="custom-upload-button"><button onClick={handleButtonClick}>
              <FontAwesomeIcon icon={faFileUpload} size='2x' />
              <FontAwesomeIcon className='ic' icon={faCheck} />
            </button>
            </div>
            <input
              id="file-upload"
              type="file"
              accept="application/pdf"
              onChange={handleFileChange}
              style={{ display: 'none' }}
            />

            {selectedFile && <p>Selected file: {selectedFile.name}</p>}
          </form>
        </main>
      </div>
    </div>
  )
}

export default HomePage